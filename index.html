<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>聖誕交換禮物系統</title>
  
  <!-- 1. 引入 Tailwind CSS (樣式庫) -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- 2. 引入 React 和 ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- 3. 引入 Babel (讓瀏覽器可以看懂 JSX) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- 4. 引入 Firebase (相容版) -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <style>
    @keyframes fade-in {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes pop-in {
      0% { opacity: 0; transform: scale(0.8); }
      70% { transform: scale(1.05); }
      100% { opacity: 1; transform: scale(1); }
    }
    .animate-fade-in { animation: fade-in 0.4s ease-out forwards; }
    .animate-pop-in { animation: pop-in 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">
  <div id="root"></div>

  <script type="text/babel">
    // --- 這裡開始是 React 程式碼 ---
    const { useState, useEffect, useMemo } = React;

    // --- 設定 Firebase (請在此處貼上您的設定) ---
    // ⚠️⚠️⚠️ 請把下面這段 firebaseConfig 換成您自己的！ ⚠️⚠️⚠️
    const firebaseConfig = {
      apiKey: "AIzaSyBu-q_aqdsEAo3paJIbLXj0QQ6Dy-1xJ3Y",
      authDomain: "gift-exchange-app-c891a.firebaseapp.com",
      projectId: "gift-exchange-app-c891a",
      storageBucket: "gift-exchange-app-c891a.firebasestorage.app",
      messagingSenderId: "1030609890092",
      appId: "1:1030609890092:web:262530dca17c358b8bda89"
    };

    // 初始化 Firebase
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const auth = firebase.auth();
    const db = firebase.firestore();
    // 設定一個活動 ID
    const appId = 'my-xmas-party-2024';

    // --- 圖示組件 (手動定義 SVG 以避免引入問題) ---
    // 修改：新增 Santa 圖示，並確保所有圖示都能接收 props
    const Icons = {
      // ... 其他原本的圖示保持不變 (Gift, Users, Shuffle 等) ...
      // 為了節省篇幅，請保留您原本的圖示，這裡只列出新增的 Santa 和需要確認的 Gift
      Gift: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect x="3" y="8" width="18" height="4" rx="1"/><path d="M12 8v13"/><path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7"/><path d="M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5"/></svg>,
      Santa: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M12 2c-4 0-6 3-6 6v1h12V8c0-3-2-6-6-6z"/><circle cx="12" cy="2" r="2"/><path d="M6 9v2a6 6 0 0 0 12 0V9"/><path d="M6 11c0 5 2.5 9 6 9s6-4 6-9"/><path d="M10 14h4"/></svg>,
      Users: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
      Shuffle: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l14.2-12.6c.8-1.1 2-1.7 3.3-1.7H26"/><path d="M2 6h1.4c1.3 0 2.5.6 3.3 1.7l14.2 12.6c.8 1.1 2 1.7 3.3 1.7H26"/></svg>,
      Search: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
      UserCircle: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><circle cx="12" cy="10" r="3"/><path d="M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662"/></svg>,
      CheckCircle2: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>,
      Trash2: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
      AlertCircle: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>,
      Sparkles: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M2 7h4"/><path d="M2 3h4"/></svg>,
      Lock: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
      ArrowLeft: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>,
      PartyPopper: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M5.8 11.3 2 22l10.7-3.79"/><path d="M4 3h.01"/><path d="M22 8h.01"/><path d="M15 2h.01"/><path d="M22 20h.01"/><path d="m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12v0c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10"/><path d="m22 13-.82-3.3c-.99-4.03-5.15-6.43-9.2-5.3L7.63 5.5c-3.96 1.1-6.13 5.36-4.92 9.43L3.5 18"/></svg>,
      KeyRound: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z"/><circle cx="16.5" cy="7.5" r=".5" fill="currentColor"/></svg>,
      Copy: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>,
      Check: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M20 6 9 17l-5-5"/></svg>,
      Trees: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M10 10v.2A3 3 0 0 1 8.9 16v0H5v0h0a3 3 0 0 1-1-5.8V10a3 3 0 0 1 5.3-1.3z"/><path d="M7 16v6"/><path d="M13 19v3"/><path d="M12 19h8.3a1 1 0 0 0 .7-1.7L18 14h.3a1 1 0 0 0 .7-1.7L16 9h.2a1 1 0 0 0 .8-1.7L13 3l-1.4 1.5"/></svg>,
      Snowflake: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><line x1="2" x2="22" y1="12" y2="12"/><line x1="12" x2="12" y1="2" y2="22"/><path d="m20 16-4-4 4-4"/><path d="m4 8 4 4-4 4"/><path d="m16 4-4 4-4-4"/><path d="m8 20 4-4 4 4"/></svg>,
      Star: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
      Ticket: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/><path d="M13 5v2"/><path d="M13 17v2"/><path d="M13 11v2"/></svg>,
      X: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
      AlertTriangle: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>,
      HelpCircle: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
    };

    // --- (元件定義 RegistrationView, ResultView, AdminView, ConfirmModal 省略，請保持原樣) ---

    // 修改：更新後的 HomePortal (加入聖誕老人和更多禮物)
    const HomePortal = ({ onNavigate }) => (
      <div className="min-h-screen bg-gradient-to-br from-green-50 via-white to-red-50 flex items-center justify-center p-4 relative overflow-hidden">
        {/* 背景動畫 - 雪花 */}
        <div className="absolute top-10 left-10 opacity-20 animate-pulse text-blue-300"><Icons.Snowflake width="48" height="48" /></div>
        <div className="absolute bottom-20 right-20 opacity-20 animate-pulse text-blue-300" style={{animationDelay: '1s'}}><Icons.Snowflake width="64" height="64" /></div>
        
        {/* 左側：漂浮的禮物 */}
        <div className="absolute top-1/4 left-5 opacity-30 animate-bounce text-red-400" style={{animationDuration: '3s'}}><Icons.Gift width="40" height="40" /></div>
        <div className="absolute bottom-1/3 left-10 opacity-20 animate-bounce text-yellow-500" style={{animationDuration: '4s'}}><Icons.Gift width="32" height="32" /></div>

        <div className="max-w-4xl w-full grid grid-cols-1 md:grid-cols-2 gap-8 items-center relative z-10">
          <div className="space-y-6 animate-fade-in">
            <div className="inline-block p-3 bg-red-100 rounded-2xl text-red-600 mb-2 shadow-inner"><Icons.Gift width="32" height="32" /></div>
            <h1 className="text-4xl md:text-5xl font-black text-gray-900 leading-tight">聖誕交換禮物<br /><span className="text-transparent bg-clip-text bg-gradient-to-r from-green-600 to-red-600">企劃部 x 數位部</span></h1>
            <p className="text-lg text-gray-600">Ho Ho Ho! 歡迎來到小天使小主人交換禮物派對。<br/>請選擇功能進入：</p>
            <div className="flex flex-col sm:flex-row gap-4 pt-4">
              <button onClick={() => onNavigate('register')} className="px-8 py-4 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-xl font-bold text-lg shadow-lg hover:shadow-green-200 transform transition hover:-translate-y-1 active:scale-95 border-b-4 border-green-800">禮物關鍵字填寫</button>
              <button onClick={() => onNavigate('result')} className="px-8 py-4 bg-white text-gray-900 border-2 border-gray-200 rounded-xl font-bold text-lg shadow-sm hover:border-red-300 hover:text-red-600 transform transition hover:-translate-y-1 active:scale-95"><div className="flex items-center"><span className="mr-2 text-gray-400"><Icons.Lock width="16" height="16" /></span> 查看我的結果</div></button>
            </div>
            <div className="pt-8 border-t border-gray-200"><button onClick={() => onNavigate('admin')} className="flex items-center text-gray-400 hover:text-gray-600 text-sm font-medium transition"><span className="mr-1"><Icons.Lock width="16" height="16" /></span> 活動主持人入口</button></div>
          </div>
          
          {/* 右側插圖 */}
          <div className="hidden md:flex justify-center animate-fade-in delay-100">
            <div className="relative transform scale-125 origin-center"> {/* 修改：加上 scale-125 放大整體 */}
              <div className="relative z-10 flex flex-col items-center">
                {/* 星星 */}
                <span className="text-yellow-400 fill-yellow-400 animate-bounce mb-[-10px] z-30"><Icons.Star width="48" height="48" /></span>
                
                <div className="flex items-end">
                  {/* 聖誕樹 */}
                  <div className="text-green-600 drop-shadow-2xl z-10"><Icons.Trees width="220" height="220" /></div>
                  {/* 已移除聖誕老人 */}
                </div>

                {/* 禮物堆 */}
                <div className="flex gap-4 mt-[-30px] z-30">
                  <div className="text-red-500 fill-red-100 rotate-[-10deg]"><Icons.Gift width="48" height="48" /></div>
                  <div className="text-blue-500 fill-blue-100 rotate-[5deg]"><Icons.Gift width="40" height="40" /></div>
                  <div className="text-yellow-500 fill-yellow-100 rotate-[15deg]"><Icons.Gift width="56" height="56" /></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    );

    // --- 主程式 ---
    const App = () => {
      const [user, setUser] = useState(null);
      const [usersData, setUsersData] = useState([]);
      const [loading, setLoading] = useState(true);
      const [currentView, setCurrentView] = useState('home');

      useEffect(() => {
        if (auth.currentUser) { setUser(auth.currentUser); }
        else { auth.signInAnonymously().then(u => setUser(u.user)).catch(e => console.error(e)); }
        return auth.onAuthStateChanged(u => setUser(u));
      }, []);

      const collectionRef = useMemo(() => db.collection('artifacts').doc(appId).collection('participants'), []);

      useEffect(() => {
        if (!user) return;
        return collectionRef.onSnapshot(snapshot => {
          const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
          data.sort((a, b) => a.createdAt > b.createdAt ? 1 : -1);
          setUsersData(data);
          setLoading(false);
        });
      }, [user, collectionRef]);

      if (loading) return <div className="min-h-screen flex items-center justify-center"><div className="animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500"></div></div>;

      return (
        <div className="min-h-screen font-sans text-gray-800 bg-gray-50">
          {currentView === 'home' && <HomePortal onNavigate={setCurrentView} />}
          {currentView !== 'home' && (
            <div className="min-h-screen py-8 px-4">
              {currentView === 'register' && <RegistrationView users={usersData} collectionRef={collectionRef} goBack={() => setCurrentView('home')} />}
              {currentView === 'result' && <ResultView users={usersData} goBack={() => setCurrentView('home')} />}
              {currentView === 'admin' && <AdminView users={usersData} collectionRef={collectionRef} goBack={() => setCurrentView('home')} />}
            </div>
          )}
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>